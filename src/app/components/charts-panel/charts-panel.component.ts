import { Component, Input, OnChanges } from '@angular/core';
import { Bot } from 'src/app/models/bot.model';
import { BotStats } from 'src/app/models/bot.stats';
import { Rounds } from 'src/app/models/competition.rounds';

@Component({
  selector: 'app-charts-panel',
  templateUrl: './charts-panel.component.html',
  styleUrls: ['./charts-panel.component.sass']
})
export class ChartsPanelComponent implements OnChanges {

  private MAX_RADIALS: number = 4;
  private MAX_SCORE_ROUNDS = 40;

  public dataReady = true;

  @Input() bots: Bot[] = [];
  @Input() botStats: BotStats = {}
  @Input() rounds: Rounds = {}

  /*
    win rate chart
  */

  public wrlabels: string[] = [];
  public wrseries: any[] = [];

  public srlabels: string[] = [];
  public srseries: any[] = [];

  /*
    score chart
  */
  public series1: any[] = [0.0,
    8.500220969323376,
    7.671128143458547,
    7.199827708929765,
    12.098944429529787,
    25.66433709029915,
    16.133789538735133,
    28.973232428508876,
    35.86149695102897,
    40.90804074346581,
    39.56826159211436,
    30.048153314627637,
    31.621398511157416,
    31.758025986908947,
    42.50822884580854,
    50.54193169710766,
    61.97897958954788,
    56.823664790305365,
    67.58870767374498,
    81.76414713939158,
    86.93829262444395,
    81.19946321094699,
    92.46819051727225,
    93.45532704784111,
    107.3176722638934,
    112.07022687062589,
    126.06014321518943,
    131.7082493604073,
    138.06958401800676,
    128.89722173669807,
    141.65306293254125,
    144.2460149139667,
    144.00043641640946,
    144.99501018649087,
    145.5880805629203,
    143.8259887259503,
    146.95498555511404,
    137.3055185112938,
    131.6586852319748,
    142.21275428120367,
    138.66129986485223,
    149.01396052333462,
    160.22261856213254,
    173.94939552805198,
    173.4951231546375,
    164.42611565043688,
    155.1720605190557,
    166.65427518084607,
    164.57896768660066,
    166.7432960732314,
    159.38217222150487,
    158.32665083950388,
    168.58341202601008,
    182.0811448715036,
    189.17896958315256,
    197.1604197268503,
    200.71148978526568,
    205.53551617047503,
    198.42225661745303,
    199.28982028106836,
    201.7726510693643,
    194.76117286349015,
    205.36404397914345,
    208.88956865876122,
    202.180259164258,
    200.09576861523456,
    191.14702173878968,
    187.58593181342985,
    180.75427768358767,
    192.34383312104578,
    203.31911108301512,
    203.76370712040546,
    201.9095975483649,
    210.80599711018283,
    221.0153484924345,
    234.88333484706345,
    239.21603635992898,
    243.03622678135227,
    254.06951901797106,
    247.05148981523652,
    252.51644799031916,
    259.3236063822999,
    263.41521226770647,
    257.633758525948,
    252.4793404403984,
    260.3072759256869,
    255.74112716535058,
    258.5845580968909,
    268.07209605315524,
    272.67447112125745,
    283.3590721147988,
    276.5549129138429,
    273.31614295235175,
    273.4801566700925,
    286.3082702381916,
    290.1967704794027,
    292.1216638075388,
    293.6982608422716,
    297.5111776812351,
    300.0].map(n => n - 230);
  public series2: any[] = [0.0,
    8.500220969323376,
    7.671128143458547,
    7.199827708929765,
    12.098944429529787,
    25.66433709029915,
    16.133789538735133,
    28.973232428508876,
    35.86149695102897,
    40.90804074346581,
    39.56826159211436,
    30.048153314627637,
    31.621398511157416,
    31.758025986908947,
    42.50822884580854,
    50.54193169710766,
    61.97897958954788,
    56.823664790305365,
    67.58870767374498,
    81.76414713939158,
    86.93829262444395,
    81.19946321094699,
    92.46819051727225,
    93.45532704784111,
    107.3176722638934,
    112.07022687062589,
    126.06014321518943,
    131.7082493604073,
    138.06958401800676,
    128.89722173669807,
    141.65306293254125,
    144.2460149139667,
    144.00043641640946,
    144.99501018649087,
    145.5880805629203,
    143.8259887259503,
    146.95498555511404,
    137.3055185112938,
    131.6586852319748,
    142.21275428120367,
    138.66129986485223,
    149.01396052333462,
    160.22261856213254,
    173.94939552805198,
    173.4951231546375,
    164.42611565043688,
    155.1720605190557,
    166.65427518084607,
    164.57896768660066,
    166.7432960732314,
    159.38217222150487,
    158.32665083950388,
    168.58341202601008,
    182.0811448715036,
    189.17896958315256,
    197.1604197268503,
    200.71148978526568,
    205.53551617047503,
    198.42225661745303,
    199.28982028106836,
    201.7726510693643,
    194.76117286349015,
    205.36404397914345,
    208.88956865876122,
    202.180259164258,
    200.09576861523456,
    191.14702173878968,
    187.58593181342985,
    180.75427768358767,
    192.34383312104578,
    203.31911108301512,
    203.76370712040546,
    201.9095975483649,
    210.80599711018283,
    221.0153484924345,
    234.88333484706345,
    239.21603635992898,
    243.03622678135227,
    254.06951901797106,
    247.05148981523652,
    252.51644799031916,
    259.3236063822999,
    263.41521226770647,
    257.633758525948,
    252.4793404403984,
    260.3072759256869,
    255.74112716535058,
    258.5845580968909,
    268.07209605315524,
    272.67447112125745,
    283.3590721147988,
    276.5549129138429,
    273.31614295235175,
    273.4801566700925,
    286.3082702381916,
    290.1967704794027,
    292.1216638075388,
    293.6982608422716,
    297.5111776812351,
    300.0];
  public labels: string[] = [];
  public subSwitchPoints: any[] = [];

  ngOnChanges(): void {
    if (Object.keys(this.botStats).length && this.bots) {
      this.setWinAndSurvivalRates();
    }

    if (Object.keys(this.rounds).length && this.bots) {
      this.setRoundAndScoreSeries();
    }
  }
  private setRoundAndScoreSeries() {
    this.series1 = [];
    this.series2 = [];
    let sum = 0;
    for (const round in this.rounds) {
      this.series1.push(this.rounds[round][0]);
      sum += this.rounds[round][0];
      this.series2.push(sum);
    }
  }

  
  

  private setWinAndSurvivalRates(): void {
    this.wrseries = [];
    this.wrlabels = [];
    this.srseries = [];
    this.srlabels = [];
    for (const bot of this.bots) {
      this.wrlabels.push(bot.bot_name);
      this.srlabels.push(bot.bot_name);
      const stats = this.botStats[bot.id];
      if (!stats) {
        this.wrseries.push(0);
        this.srseries.push(0);
      } else {
        this.wrseries.push(Math.round(stats[0] * 100));
        this.srseries.push(Math.round(stats[1] * 100));
      }
    }
  }
}
